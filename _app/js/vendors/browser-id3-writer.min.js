!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.ID3Writer=r():e.ID3Writer=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function a(e){for(var r=[],t=255,n=24;n>=0;n-=8)r.push(e>>>n&t);return r}function i(e){for(var r=[],t=127,n=21;n>=0;n-=7)r.push(e>>>n&t);return r}function o(e){for(var r=0,t=0,n=21;n>=0;n-=7,t++)r+=e[t]<<n;return r}function s(e){return e.join("/")||"Unknown Artist"}function u(e){return e.join(";")}function f(e){var r=0;return e.forEach(function(e){r+=e.size}),r}function c(e){var r=10,t=1;return r+t+e}function l(e){var r=10,t=1,n=2,a=2*e;return r+t+n+a}function h(e){var r=10,t=1,n=3,a=2,i=2,o=2*e;return r+t+n+i+a+i+o}function y(e,r){var t=10,n=1,a=1,i=1;return t+n+r+a+i+a+e}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},m=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),p=t(1),v=t(2),d=function(){function e(r){if(n(this,e),!(r&&"object"===("undefined"==typeof r?"undefined":g(r))&&"byteLength"in r))throw new Error("First argument should be an instance of ArrayBuffer or Buffer");this.arrayBuffer=r,this.padding=4096,this.frames=[],this.url=""}return m(e,[{key:"_setIntegerFrame",value:function(e,r){var t=parseInt(r,10);this.frames.push({name:e,value:t,size:c(t.toString().length)})}},{key:"_setStringFrame",value:function(e,r){var t=r.toString();this.frames.push({name:e,value:t,size:l(t.length)})}},{key:"_setPictureFrame",value:function(e,r){var t=v.getMimeType(new Uint8Array(r),0,12);if(!t)throw new Error("Unknown picture MIME type");this.frames.push({name:e,value:r,mimeType:t,size:y(r.byteLength,t.length)})}},{key:"_setLyricsFrame",value:function(e,r){var t=r.toString();this.frames.push({name:e,value:t,size:h(t.length)})}}]),m(e,[{key:"setFrame",value:function(e,r){switch(e){case"TPE1":case"TCOM":if(!Array.isArray(r))throw new Error(e+" frame value should be an array of strings");var t=r.map(function(e){return e.toString()}),n=s(t);this._setStringFrame(e,n);break;case"TCON":if(!Array.isArray(r))throw new Error(e+" frame value should be an array of strings");var a=r.map(function(e){return e.toString()}),i=u(a);this._setStringFrame(e,i);break;case"TIT2":case"TALB":case"TPE2":case"TRCK":case"TPOS":case"TPUB":this._setStringFrame(e,r);break;case"TLEN":case"TYER":this._setIntegerFrame(e,r);break;case"USLT":this._setLyricsFrame(e,r);break;case"APIC":if("object"!==("undefined"==typeof r?"undefined":g(r))||!("byteLength"in r))throw new Error("APIC frame value should be an instance of ArrayBuffer or Buffer");this._setPictureFrame(e,r);break;default:throw new Error("Unsupported frame "+e)}return this}},{key:"removeTag",value:function(){var e=10,r=this.arrayBuffer.byteLength;if(!(e>r)){var t=new Uint8Array(this.arrayBuffer,0,e),n=t[3],a=o([t[6],t[7],t[8],t[9]])+e;!v.isId3v2(t)||2>n||n>4||(this.arrayBuffer=this.arrayBuffer.slice(a))}}},{key:"addTag",value:function(){this.removeTag();var e=[255,254],r=10,t=f(this.frames),n=r+t+this.padding,o=new ArrayBuffer(this.arrayBuffer.byteLength+n),s=new Uint8Array(o),u=0,c=[];return c=[73,68,51,3],s.set(c,u),u+=c.length,u++,u++,c=i(n-r),s.set(c,u),u+=c.length,this.frames.forEach(function(t){switch(c=p.encodeUtf8Ascii(t.name),s.set(c,u),u+=c.length,c=a(t.size-r),s.set(c,u),u+=c.length,u+=2,t.name){case"TPE1":case"TCOM":case"TCON":case"TIT2":case"TALB":case"TPE2":case"TRCK":case"TPOS":case"TPUB":c=[1].concat(e),s.set(c,u),u+=c.length,c=p.encodeUtf16le(t.value),s.set(c,u),u+=c.length;break;case"USLT":var n=[101,110,103];c=[1].concat(n,e),s.set(c,u),u+=c.length,u+=2,c=e,s.set(c,u),u+=c.length,c=p.encodeUtf16le(t.value),s.set(c,u),u+=c.length;break;case"TLEN":case"TYER":u++,c=p.encodeUtf8Ascii(t.value),s.set(c,u),u+=c.length;break;case"APIC":u++,c=p.encodeUtf8Ascii(t.mimeType),s.set(c,u),u+=c.length,c=[0,3,0],s.set(c,u),u+=c.length,s.set(new Uint8Array(t.value),u),u+=t.value.byteLength}}),u+=this.padding,s.set(new Uint8Array(this.arrayBuffer),u),this.arrayBuffer=o,o}},{key:"getBlob",value:function(){return new Blob([this.arrayBuffer],{type:"audio/mpeg"})}},{key:"getURL",value:function(){return this.url||(this.url=URL.createObjectURL(this.getBlob())),this.url}},{key:"revokeURL",value:function(){URL.revokeObjectURL(this.url)}}]),e}();e.exports=d},function(e,r){"use strict";function t(e){var r=String(e).split("").map(function(e){var r=e.charCodeAt(0);if(r>127)throw new Error("Trying to encode not ASCII symbol");return r});return new Uint8Array(r)}function n(e){var r=String(e).split("").map(function(e){return e.charCodeAt(0)}),t=new Uint8Array(2*e.length);return new Uint16Array(t.buffer).set(r),t}e.exports={encodeUtf8Ascii:t,encodeUtf16le:n}},function(e,r){"use strict";function t(e){return 73===e[0]&&68===e[1]&&51===e[2]}function n(e){if(!e||!e.length)return null;if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(87===e[8]&&69===e[9]&&66===e[10]&&80===e[11])return"image/webp";var r=73===e[0]&&73===e[1]&&42===e[2]&&0===e[3],t=77===e[0]&&77===e[1]&&0===e[2]&&42===e[3];return r||t?"image/tiff":66===e[0]&&77===e[1]?"image/bmp":0===e[0]&&0===e[1]&&1===e[2]&&0===e[3]?"image/x-icon":null}e.exports={isId3v2:t,getMimeType:n}}])});
//# sourceMappingURL=browser-id3-writer.min.js.map