!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.ID3Writer=b():a.ID3Writer=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a){for(var b=[],c=255,d=24;d>=0;d-=8)b.push(a>>>d&c);return b}function f(a){for(var b=[],c=127,d=21;d>=0;d-=7)b.push(a>>>d&c);return b}function g(a){for(var b=0,c=0,d=21;d>=0;d-=7,c++)b+=a[c]<<d;return b}function h(a){return a.join("/")||"Unknown Artist"}function i(a){return a.join(";")}function j(a){var b=0;return a.forEach(function(a){b+=a.size}),b}function k(a){var b=10,c=1;return b+c+a}function l(a){var b=10,c=1,d=2,e=2*a;return b+c+d+e}function m(a){var b=10,c=1,d=3,e=2,f=2,g=2*a;return b+c+d+f+e+f+g}function n(a,b){var c=10,d=1,e=1,f=1;return c+d+b+e+f+e+a}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),q=c(1),r=c(2),s=function(){function a(b){if(d(this,a),!(b&&"object"===("undefined"==typeof b?"undefined":o(b))&&"byteLength"in b))throw new Error("First argument should be an instance of ArrayBuffer or Buffer");this.arrayBuffer=b,this.padding=4096,this.frames=[],this.url=""}return p(a,[{key:"_setIntegerFrame",value:function(a,b){var c=parseInt(b,10);this.frames.push({name:a,value:c,size:k(c.toString().length)})}},{key:"_setStringFrame",value:function(a,b){var c=b.toString();this.frames.push({name:a,value:c,size:l(c.length)})}},{key:"_setPictureFrame",value:function(a,b){var c=r.getMimeType(new Uint8Array(b),0,12);if(!c)throw new Error("Unknown picture MIME type");this.frames.push({name:a,value:b,mimeType:c,size:n(b.byteLength,c.length)})}},{key:"_setLyricsFrame",value:function(a,b){var c=b.toString();this.frames.push({name:a,value:c,size:m(c.length)})}}]),p(a,[{key:"setFrame",value:function(a,b){switch(a){case"TPE1":case"TCOM":if(!Array.isArray(b))throw new Error(a+" frame value should be an array of strings");var c=b.map(function(a){return a.toString()}),d=h(c);this._setStringFrame(a,d);break;case"TCON":if(!Array.isArray(b))throw new Error(a+" frame value should be an array of strings");var e=b.map(function(a){return a.toString()}),f=i(e);this._setStringFrame(a,f);break;case"TIT2":case"TALB":case"TPE2":case"TRCK":case"TPOS":case"TPUB":this._setStringFrame(a,b);break;case"TLEN":case"TYER":this._setIntegerFrame(a,b);break;case"USLT":this._setLyricsFrame(a,b);break;case"APIC":if("object"!==("undefined"==typeof b?"undefined":o(b))||!("byteLength"in b))throw new Error("APIC frame value should be an instance of ArrayBuffer or Buffer");this._setPictureFrame(a,b);break;default:throw new Error("Unsupported frame "+a)}return this}},{key:"removeTag",value:function(){var a=10,b=this.arrayBuffer.byteLength;if(!(a>b)){var c=new Uint8Array(this.arrayBuffer,0,a),d=c[3],e=g([c[6],c[7],c[8],c[9]])+a;!r.isId3v2(c)||2>d||d>4||(this.arrayBuffer=this.arrayBuffer.slice(e))}}},{key:"addTag",value:function(){this.removeTag();var a=[255,254],b=10,c=j(this.frames),d=b+c+this.padding,g=new ArrayBuffer(this.arrayBuffer.byteLength+d),h=new Uint8Array(g),i=0,k=[];return k=[73,68,51,3],h.set(k,i),i+=k.length,i++,i++,k=f(d-b),h.set(k,i),i+=k.length,this.frames.forEach(function(c){switch(k=q.encodeUtf8Ascii(c.name),h.set(k,i),i+=k.length,k=e(c.size-b),h.set(k,i),i+=k.length,i+=2,c.name){case"TPE1":case"TCOM":case"TCON":case"TIT2":case"TALB":case"TPE2":case"TRCK":case"TPOS":case"TPUB":k=[1].concat(a),h.set(k,i),i+=k.length,k=q.encodeUtf16le(c.value),h.set(k,i),i+=k.length;break;case"USLT":var d=[101,110,103];k=[1].concat(d,a),h.set(k,i),i+=k.length,i+=2,k=a,h.set(k,i),i+=k.length,k=q.encodeUtf16le(c.value),h.set(k,i),i+=k.length;break;case"TLEN":case"TYER":i++,k=q.encodeUtf8Ascii(c.value),h.set(k,i),i+=k.length;break;case"APIC":i++,k=q.encodeUtf8Ascii(c.mimeType),h.set(k,i),i+=k.length,k=[0,3,0],h.set(k,i),i+=k.length,h.set(new Uint8Array(c.value),i),i+=c.value.byteLength}}),i+=this.padding,h.set(new Uint8Array(this.arrayBuffer),i),this.arrayBuffer=g,g}},{key:"getBlob",value:function(){return new Blob([this.arrayBuffer],{type:"audio/mpeg"})}},{key:"getURL",value:function(){return this.url||(this.url=URL.createObjectURL(this.getBlob())),this.url}},{key:"revokeURL",value:function(){URL.revokeObjectURL(this.url)}}]),a}();a.exports=s},function(a,b){"use strict";function c(a){var b=String(a).split("").map(function(a){var b=a.charCodeAt(0);if(b>127)throw new Error("Trying to encode not ASCII symbol");return b});return new Uint8Array(b)}function d(a){var b=String(a).split("").map(function(a){return a.charCodeAt(0)}),c=new Uint8Array(2*a.length);return new Uint16Array(c.buffer).set(b),c}a.exports={encodeUtf8Ascii:c,encodeUtf16le:d}},function(a,b){"use strict";function c(a){return 73===a[0]&&68===a[1]&&51===a[2]}function d(a){if(!a||!a.length)return null;if(255===a[0]&&216===a[1]&&255===a[2])return"image/jpeg";if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])return"image/png";if(71===a[0]&&73===a[1]&&70===a[2])return"image/gif";if(87===a[8]&&69===a[9]&&66===a[10]&&80===a[11])return"image/webp";var b=73===a[0]&&73===a[1]&&42===a[2]&&0===a[3],c=77===a[0]&&77===a[1]&&0===a[2]&&42===a[3];return b||c?"image/tiff":66===a[0]&&77===a[1]?"image/bmp":0===a[0]&&0===a[1]&&1===a[2]&&0===a[3]?"image/x-icon":null}a.exports={isId3v2:c,getMimeType:d}}])});
//# sourceMappingURL=browser-id3-writer.min.js.map